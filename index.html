<!DOCTYPE html>
<html>
<head>
  <title>Home Project Tracker</title>
</head>
<body>
  <h2>Home Project Tracker</h2>
  <form id="projectForm">
    <input type="text" id="name" placeholder="Project Name" autocomplete="off" required />
    <input type="number" id="priority" placeholder="Priority (1â€“5)" autocomplete="off" required min="1" max="5" />
    <select id="status" autocomplete="off">
      <option value="Not Started">Not Started</option>
      <option value="In Progress">In Progress</option>
      <option value="Complete">Complete</option>
    </select>
    <button type="submit">Add Project</button>
  </form>

  <ul id="projectList"></ul>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzZ6lR1XKvsYj0A6oSK3Z5CQvJkEYYR-eGllQ5sQThOI2QhuzUPt_bOhbFBX_XjyT0R/exec';
    const TOKEN = 'Project1285'; // Use the same token as in your Apps Script

    const form = document.getElementById('projectForm');
    const list = document.getElementById('projectList');

// Delete project row from Google Sheets
async function deleteProject(row) {
  const query = new URLSearchParams({
    token: TOKEN,
    deleteRow: row
  }).toString();

  console.log('Attempting to delete row:', row); 

  try {
    await fetch(`${API_URL}?${query}`);
  } catch (err) {
    console.error('Failed to update project:', err);
  }
}

  // update project in google sheets  
async function updateProject(row, name, priority, status) {
  const query = new URLSearchParams({
    token: TOKEN,
    updateRow: row,
    Name: name,
    Priority: priority,
    Status: status
  }).toString();

  try {
    await fetch(`${API_URL}?${query}`);
  } catch (err) {
    console.error('Failed to update project:', err);
  }
}

// Load projects and render with Delete buttons
async function loadProjects() {
  try {
    const res = await fetch(`${API_URL}?token=${TOKEN}`);
    const data = await res.json();
    console.log('Fetched project data:', data);

    list.innerHTML = '';
    data.forEach((project, index) => {
      const li = document.createElement('li');
      const rowIndex = index + 2; // skip header row
     
      // Add project text
    const text = document.createTextNode(
      `${project.Name} (Priority: ${project.Priority}, Status: ${project.Status}) `
    );
    li.appendChild(text);

    // Create Delete Button
    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'Delete';
    deleteBtn.style.marginLeft = '8px'; // (optional) spacing for clarity
    deleteBtn.onclick = async () => {
      await deleteProject(index + 2); // Adjust for headers
      loadProjects();
    };

    // Add button to <li>
    li.appendChild(deleteBtn);

    // Edit Button
    const editBtn = document.createElement('button');
    editBtn.textContent = 'Edit';
    editBtn.style.marginLeft = '8px';
    editBtn.onclick = () => {
      renderEditForm(li, project, rowIndex);
    };
    // Add button to <li>
    li.appendChild(editBtn);
      
    // Add <li> to the list
    list.appendChild(li);
  });

  } catch (err) {
    console.error('Failed to load projects:', err);
    list.innerHTML = '<li>Error loading projects.</li>';
  }
}

    function renderEditForm(li, project, rowIndex) {
      li.innerHTML = '';

    const nameInput = document.createElement('input');
    nameInput.value = project.Name;

    const priorityInput = document.createElement('input');
    priorityInput.type = 'number';
    priorityInput.value = project.Priority;
    priorityInput.min = 1;
    priorityInput.max = 5;

    const statusSelect = document.createElement('select');
    ['Not Started', 'In Progress', 'Complete'].forEach(status => {
      const option = document.createElement('option');
      option.value = status;
      option.textContent = status;
      if (status === project.Status) option.selected = true;
      statusSelect.appendChild(option);
    });

    const saveBtn = document.createElement('button');
    saveBtn.textContent = 'Save';
    saveBtn.onclick = async () => {
      await updateProject(rowIndex, nameInput.value, priorityInput.value, statusSelect.value);
      loadProjects();
    };

    li.appendChild(nameInput);
    li.appendChild(priorityInput);
    li.appendChild(statusSelect);
    li.appendChild(saveBtn);
  }


    // Add project via POST
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const priority = document.getElementById('priority').value;
      const status = document.getElementById('status').value;

      const payload = {
        token: TOKEN,
        Name: name,
        Priority: priority,
        Status: status
      };

      try {
        const query = new URLSearchParams({
          token: TOKEN,
          Name: name,
          Priority: priority,
          Status: status
        }).toString();

        await fetch(`${API_URL}?${query}`);


        form.reset();
        loadProjects(); // Refresh list
      } catch (err) {
        console.error('Failed to add project:', err);
      }
    });

    // Initial load
    loadProjects();
  </script>
</body>
</html>








